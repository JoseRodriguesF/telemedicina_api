generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id           Int         @id @default(autoincrement())
  email        String      @unique @db.VarChar(255)
  senha_hash   String?     @db.VarChar(255)
  google_id    String?     @unique @map("google_id") @db.VarChar(255)
  registroFull Boolean     @default(false) @map("registro_full")
  tipo_usuario TipoUsuario
  medico       Medico?
  paciente     Paciente?
  enderecos    Endereco[]

  @@map("usuarios")
}

model Paciente {
  id                   Int      @id @default(autoincrement())
  usuario_id           Int      @unique
  nome_completo        String   @db.VarChar(255)
  data_nascimento      DateTime @db.Date
  cpf                  String   @unique @db.VarChar(14)
  sexo                 String   @db.VarChar(20)
  estado_civil         String   @db.VarChar(50)
  telefone             String   @db.VarChar(11)
  responsavel_legal    String?  @db.VarChar(255)
  telefone_responsavel String?  @db.VarChar(20)
  usuario              Usuario  @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  consultas            Consulta[] @relation("ConsultaPaciente")

  @@map("pacientes")
}

model Medico {
  id                          Int      @id @default(autoincrement())
  usuario_id                  Int      @unique
  nome_completo               String   @db.VarChar(255)
  data_nascimento             DateTime @db.Date
  cpf                         String   @unique @db.VarChar(14)
  sexo                        String?  @db.VarChar(20)
  crm                         String   @db.VarChar(50)
  diploma_url                 String?  @db.VarChar(255)
  especializacao_url          String?  @db.VarChar(255)
  assinatura_digital_url      String?  @db.VarChar(255)
  seguro_responsabilidade_url String?  @db.VarChar(255)
  verificacao                 StatusVerificacao @default(analise)
  usuario                     Usuario  @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  consultas                   Consulta[] @relation("ConsultaMedico")

  @@map("medicos")
}

model Endereco {
  id          Int      @id @default(autoincrement())
  usuario_id  Int
  endereco    String
  numero      Int
  complemento String?

  usuario     Usuario @relation(fields: [usuario_id], references: [id], onDelete: Cascade)

  @@map("enderecos")
}

enum TipoUsuario {
  medico
  paciente
  admin

  @@map("tipo_usuario_enum")
}

enum StatusVerificacao {
  analise
  verificado
  recusado

  @@map("status_verificacao_enum")
}

enum ConsultaStatus {
  scheduled
  in_progress
  finished

  @@map("consulta_status_enum")
}

model Consulta {
  id          Int             @id @default(autoincrement())
  medicoId    Int?            @map("medico_id")
  pacienteId  Int             @map("paciente_id")
  status      ConsultaStatus
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")

  medico      Medico?         @relation(name: "ConsultaMedico", fields: [medicoId], references: [id], onDelete: Cascade)
  paciente    Paciente        @relation(name: "ConsultaPaciente", fields: [pacienteId], references: [id], onDelete: Cascade)

  @@index([medicoId], name: "idx_consultas_medico_id")
  @@index([pacienteId], name: "idx_consultas_paciente_id")
  @@index([medicoId, pacienteId], name: "idx_consultas_medico_paciente")
  @@map("consultas")
}
